selected_ratings['size'] = cut(
selected_ratings$meter.value,
breaks = c(0, 1.3, 1.9, 2.3, 2.5),
labels = c('flying hill', 'large', 'normal', 'medium')
)
selected_ratings['performance'] = 2*as.numeric(cut(
selected_ratings$delty,
breaks = c(-1000,0,1000),
labels = c(-1,+1)
))-3
size_ratings = selected_ratings %>% group_by(size,codex.x) %>% summarize(performance = mean(performance, na.rm = TRUE)) %>% na.omit()
size_ratings = merge(size_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
tmp_title <- 'Performance on all types of hills'
size_ratings %>% mutate(name=fct_reorder(name) %>% ggplot(aes(name,performance, fill = size)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()
selected_ids = unique(filter(competitions,season == 2021, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1550)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = merge(selected_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'delty', 'meter.value', 'codex.x')]
selected_ratings['size'] = cut(
selected_ratings$meter.value,
breaks = c(0, 1.3, 1.9, 2.3, 2.5),
labels = c('flying hill', 'large', 'normal', 'medium')
)
selected_ratings['performance'] = 2*as.numeric(cut(
selected_ratings$delty,
breaks = c(-1000,0,1000),
labels = c(-1,+1)
))-3
size_ratings = selected_ratings %>% group_by(size,codex.x) %>% summarize(performance = mean(performance, na.rm = TRUE)) %>% na.omit()
size_ratings = merge(size_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
tmp_title <- 'Performance on all types of hills'
size_ratings %>% mutate(name=fct_reorder(name)) %>% ggplot(aes(name,performance, fill = size)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()
?fct_reorder
selected_ids = unique(filter(competitions,season == 2021, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1550)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = merge(selected_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'delty', 'meter.value', 'codex.x')]
selected_ratings['size'] = cut(
selected_ratings$meter.value,
breaks = c(0, 1.3, 1.9, 2.3, 2.5),
labels = c('flying hill', 'large', 'normal', 'medium')
)
selected_ratings['performance'] = 2*as.numeric(cut(
selected_ratings$delty,
breaks = c(-1000,0,1000),
labels = c(-1,+1)
))-3
size_ratings = selected_ratings %>% group_by(size,codex.x) %>% summarize(performance = mean(performance, na.rm = TRUE)) %>% na.omit()
size_ratings = merge(size_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
tmp_title <- 'Performance on all types of hills'
size_ratings %>% mutate(name=sort(name)) %>% ggplot(aes(name,performance, fill = size)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()
View(size_ratings)
selected_ids = unique(filter(competitions,season == 2021, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1550)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = merge(selected_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'delty', 'meter.value', 'codex.x')]
selected_ratings['size'] = cut(
selected_ratings$meter.value,
breaks = c(0, 1.3, 1.9, 2.3, 2.5),
labels = c('flying hill', 'large', 'normal', 'medium')
)
selected_ratings['performance'] = 2*as.numeric(cut(
selected_ratings$delty,
breaks = c(-1000,0,1000),
labels = c(-1,+1)
))-3
size_ratings = selected_ratings %>% group_by(size,codex.x) %>% summarize(performance = mean(performance, na.rm = TRUE)) %>% na.omit()
size_ratings = merge(size_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
tmp_title <- 'Performance on all types of hills'
size_ratings %>% mutate(name=fct_reorder(name,sort)) %>% ggplot(aes(name,performance, fill = size)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()
?mutate
?sort
selected_ids = unique(filter(competitions,season == 2021, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1550)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = merge(selected_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'delty', 'meter.value', 'codex.x')]
selected_ratings['size'] = cut(
selected_ratings$meter.value,
breaks = c(0, 1.3, 1.9, 2.3, 2.5),
labels = c('flying hill', 'large', 'normal', 'medium')
)
selected_ratings['performance'] = 2*as.numeric(cut(
selected_ratings$delty,
breaks = c(-1000,0,1000),
labels = c(-1,+1)
))-3
size_ratings = selected_ratings %>% group_by(size,codex.x) %>% summarize(performance = mean(performance, na.rm = TRUE)) %>% na.omit()
size_ratings = merge(size_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
tmp_title <- 'Performance on all types of hills'
size_ratings %>% mutate(name=fct_reorder(name,order)) %>% ggplot(aes(name,performance, fill = size)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()
selected_ids = unique(filter(competitions,season == 2021, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1550)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = merge(selected_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'delty', 'meter.value', 'codex.x')]
selected_ratings['size'] = cut(
selected_ratings$meter.value,
breaks = c(0, 1.3, 1.9, 2.3, 2.5),
labels = c('flying hill', 'large', 'normal', 'medium')
)
selected_ratings['performance'] = 2*as.numeric(cut(
selected_ratings$delty,
breaks = c(-1000,0,1000),
labels = c(-1,+1)
))-3
size_ratings = selected_ratings %>% group_by(size,codex.x) %>% summarize(performance = mean(performance, na.rm = TRUE)) %>% na.omit()
size_ratings = merge(size_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
tmp_title <- 'Performance on all types of hills'
size_ratings[order('name'),] %>% ggplot(aes(name,performance, fill = size)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()
?arrange
selected_ids = unique(filter(competitions,season == 2021, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1550)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = merge(selected_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'delty', 'meter.value', 'codex.x')]
selected_ratings['size'] = cut(
selected_ratings$meter.value,
breaks = c(0, 1.3, 1.9, 2.3, 2.5),
labels = c('flying hill', 'large', 'normal', 'medium')
)
selected_ratings['performance'] = 2*as.numeric(cut(
selected_ratings$delty,
breaks = c(-1000,0,1000),
labels = c(-1,+1)
))-3
size_ratings = selected_ratings %>% group_by(size,codex.x) %>% summarize(performance = mean(performance, na.rm = TRUE)) %>% na.omit()
size_ratings = merge(size_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
tmp_title <- 'Performance on all types of hills'
size_ratings %>% arrange(name) %>% ggplot(aes(name,performance, fill = size)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(e1071)
ratings = read.csv('all_ratings.csv',sep=',',dec='.',stringsAsFactors = TRUE)
names = read.csv('all_names.csv',sep=',',dec='.',stringsAsFactors = TRUE)
competitions = read.csv('all_comps_r.csv',sep=',',dec='.',stringsAsFactors = TRUE)
results = read.csv('all_results.csv',sep=',',dec='.',stringsAsFactors = TRUE)
ratings['size'] = cut(
selected_ratings$meter.value,
breaks = c(0, 1.3, 1.9, 2.3, 2.5),
labels = c('flying hill', 'large', 'normal', 'medium')
)
library(tidyverse)
library(e1071)
ratings = read.csv('all_ratings.csv',sep=',',dec='.',stringsAsFactors = TRUE)
names = read.csv('all_names.csv',sep=',',dec='.',stringsAsFactors = TRUE)
competitions = read.csv('all_comps_r.csv',sep=',',dec='.',stringsAsFactors = TRUE)
results = read.csv('all_results.csv',sep=',',dec='.',stringsAsFactors = TRUE)
ratings['performance'] = 2*as.numeric(cut(
ratings$delty,
breaks = c(-1000,0,1000),
labels = c(-1,+1)
))-3
summary(ratings)
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(e1071)
ratings = read.csv('all_ratings.csv',sep=',',dec='.',stringsAsFactors = TRUE)
names = read.csv('all_names.csv',sep=',',dec='.',stringsAsFactors = TRUE)
competitions = read.csv('all_comps_r.csv',sep=',',dec='.',stringsAsFactors = TRUE)
results = read.csv('all_results.csv',sep=',',dec='.',stringsAsFactors = TRUE)
ratings['performance'] = 2*as.numeric(cut(
ratings$delty,
breaks = c(-1000,0,1000),
labels = c(-1,+1)
))-3
summary(ratings)
graph_names = c('kraft stefan','kobayashi ryoyu', 'kasai noriaki', 'granerud halvor egner', 'loitzl wolfgang')
for (name in graph_names){
jumper_id = names[names['name'] == name,2][1]
filtered_ratings = filter(ratings, codex == jumper_id)[, c('cumm_rating', 'id', 'number')]
tmp_title <- paste('Performance graph of: ', name)
graph <- ggplot(filtered_ratings, aes(number, cumm_rating)) + geom_smooth() + geom_line() + labs(title=tmp_title) + xlim(0,max(ratings['number'])) + ylim(600,2000)
print(graph)
}
graph_names = c('kraft stefan',
'kubacki dawid',
'kasai noriaki',
'lundby maren')
for (name in graph_names) {
jumper_id = names[names['name'] == name, 2][1]
filtered_ratings = filter(ratings, codex == jumper_id)[, c('delty', 'id', 'number')]
filtered_ratings = merge(filtered_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('delty', 'id', 'meter.value', 'number')]
filtered_ratings['size'] = cut(
filtered_ratings$meter.value,
breaks = c(0, 1.3, 1.9, 2.3, 2.5),
labels = c('flying hill', 'large', 'normal', 'medium')
)
filtered_ratings$csum <-
ave(filtered_ratings$delty, filtered_ratings$size, FUN = cumsum)
filtered_ratings = merge(
filtered_ratings,
as.data.frame(table(filtered_ratings$size)),
how = 'left',
by.x = 'size',
by.y = 'Var1'
)
tmp_title <- paste('Performance boxplot by hill of: ', name)
print(ggplot(filtered_ratings, aes(size, delty, fill = size)) + geom_boxplot() + ylim(-20, 20) + labs(title=tmp_title))
tmp_title_2 <- paste('Performance graph by hill type of: ', name)
print(ggplot(filtered_ratings, aes(number, csum, color = size)) + geom_smooth() + geom_line() + labs(title=tmp_title_2)+ xlim(0,max(ratings['number'])) + ylim(-500,1000))
}
selected_ids = unique(filter(competitions,season == 2021, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1550)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = merge(selected_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'delty', 'meter.value', 'codex.x')]
selected_ratings['size'] = cut(
selected_ratings$meter.value,
breaks = c(0, 1.3, 1.9, 2.3, 2.5),
labels = c('flying hill', 'large', 'normal', 'medium')
)
size_ratings = selected_ratings %>% group_by(size,codex.x) %>% summarize(performance = mean(performance, na.rm = TRUE)) %>% na.omit()
View(selected_ratings)
View(results)
View(ratings)
View(selected_ratings)
selected_ids = unique(filter(competitions,season == 2021, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1550)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = merge(selected_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'performance', 'meter.value', 'codex.x')]
selected_ratings['size'] = cut(
selected_ratings$meter.value,
breaks = c(0, 1.3, 1.9, 2.3, 2.5),
labels = c('flying hill', 'large', 'normal', 'medium')
)
size_ratings = selected_ratings %>% group_by(size,codex.x) %>% summarize(performance = mean(performance, na.rm = TRUE)) %>% na.omit()
size_ratings = merge(size_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
tmp_title <- 'Performance on all types of hills'
size_ratings %>% arrange(name) %>% ggplot(aes(name,performance, fill = size)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()
selected_ids = unique(filter(competitions,season == 2021, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = merge(selected_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'performance', 'meter.value', 'codex.x')]
selected_ratings['size'] = cut(
selected_ratings$meter.value,
breaks = c(0, 1.3, 1.9, 2.3, 2.5),
labels = c('flying hill', 'large', 'normal', 'medium')
)
size_ratings = selected_ratings %>% group_by(size,codex.x) %>% summarize(performance = mean(performance, na.rm = TRUE), n = n()) %>% na.omit()
size_ratings = merge(size_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
for (hill_type in levels(size_ratings$size)){
u=table(levels(size_ratings$size))
u[c('large','flying hill','normal','medium')]=c(90,30,60,10)
size_ratings_type = filter(size_ratings, size == hill_type & performance > 0 & n>=u[hill_type])
size_ratings_type = size_ratings_type %>% arrange(desc(performance)) %>% slice(1:15)
tmp_title <- paste('Performance on', hill_type)
print(size_ratings_type %>% mutate(name=fct_reorder(name,performance,sum)) %>% ggplot(aes(name,performance, fill = size)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip())
}
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1550)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, results, by = c('codex','round','id'))[,c('codex','performance','wind')] %>% na.omit()
selected_ratings['wind_type'] = cut(selected_ratings$wind, breaks = c(-10,0,10), labels=c('tail','head'))
wind_ratings = selected_ratings %>% group_by(wind_type,codex) %>% summarize(performance = mean(performance, na.rm = TRUE)) %>% na.omit()
wind_ratings = merge(wind_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex', by.y='codex')
tmp_title <- 'Performance while tail or head wind'
wind_ratings %>% mutate(name=fct_reorder(name,delty,sum)) %>% ggplot(aes(name,delty, fill=wind_type)) + geom_bar(stat='identity')+ coord_flip() + labs(title=tmp_title)
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1550)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, results, by = c('codex','round','id'))[,c('codex','performance','wind')] %>% na.omit()
selected_ratings['wind_type'] = cut(selected_ratings$wind, breaks = c(-10,0,10), labels=c('tail','head'))
wind_ratings = selected_ratings %>% group_by(wind_type,codex) %>% summarize(performance = mean(performance, na.rm = TRUE)) %>% na.omit()
wind_ratings = merge(wind_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex', by.y='codex')
tmp_title <- 'Performance while tail or head wind'
wind_ratings %>% mutate(name=fct_reorder(name,performance,sum)) %>% ggplot(aes(name,delty, fill=wind_type)) + geom_bar(stat='identity')+ coord_flip() + labs(title=tmp_title)
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1550)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, results, by = c('codex','round','id'))[,c('codex','performance','wind')] %>% na.omit()
selected_ratings['wind_type'] = cut(selected_ratings$wind, breaks = c(-10,0,10), labels=c('tail','head'))
wind_ratings = selected_ratings %>% group_by(wind_type,codex) %>% summarize(performance = mean(performance, na.rm = TRUE)) %>% na.omit()
wind_ratings = merge(wind_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex', by.y='codex')
tmp_title <- 'Performance while tail or head wind'
wind_ratings %>% mutate(name=fct_reorder(name,performance,sum)) %>% ggplot(aes(name,performance, fill=wind_type)) + geom_bar(stat='identity')+ coord_flip() + labs(title=tmp_title)
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1550)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, results, by = c('codex','round','id'))[,c('codex','performance','wind')] %>% na.omit()
selected_ratings['wind_type'] = cut(selected_ratings$wind, breaks = c(-10,0,10), labels=c('tail','head'))
wind_ratings = selected_ratings %>% group_by(wind_type,codex) %>% summarize(performance = mean(performance, na.rm = TRUE)) %>% na.omit()
wind_ratings = merge(wind_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex', by.y='codex')
tmp_title <- 'Performance while tail or head wind'
wind_ratings %>% ggplot(aes(name,performance, fill=wind_type)) + geom_bar(stat='identity')+ coord_flip() + labs(title=tmp_title)
View(wind_ratings)
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1550)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, results, by = c('codex','round','id'))[,c('codex','performance','wind')] %>% na.omit()
selected_ratings['wind_type'] = cut(selected_ratings$wind, breaks = c(-10,0,10), labels=c('tail','head'))
wind_ratings = selected_ratings %>% group_by(wind_type,codex) %>% summarize(performance = mean(performance, na.rm = TRUE)) %>% na.omit()
wind_ratings = merge(wind_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex', by.y='codex')
tmp_title <- 'Performance while tail or head wind'
wind_ratings %>% mutate(name=fct_reorder(name,performance,sum)) %>% ggplot(aes(name,performance, fill=wind_type)) + geom_bar(stat='identity')+ coord_flip() + labs(title=tmp_title)
View(selected_ratings)
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1550)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, results, by = c('codex','round','id'))[,c('codex','performance','wind')] %>% na.omit()
selected_ratings['wind_type'] = cut(selected_ratings$wind, breaks = c(-10,0,10), labels=c('tail','head'))
wind_ratings = selected_ratings %>% group_by(wind_type,codex) %>% summarize(performance = sum(performance, na.rm = TRUE)) %>% na.omit()
wind_ratings = merge(wind_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex', by.y='codex')
tmp_title <- 'Performance while tail or head wind'
wind_ratings %>% mutate(name=fct_reorder(name,performance,sum)) %>% ggplot(aes(name,performance, fill=wind_type)) + geom_bar(stat='identity')+ coord_flip() + labs(title=tmp_title)
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1550)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, results, by = c('codex','round','id'))[,c('codex','performance','wind')] %>% na.omit()
selected_ratings['wind_type'] = cut(selected_ratings$wind, breaks = c(-10,0,10), labels=c('tail','head'))
wind_ratings = selected_ratings %>% group_by(wind_type,codex) %>% summarize(performance = mean(performance, na.rm = TRUE)) %>% na.omit()
wind_ratings = merge(wind_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex', by.y='codex')
tmp_title <- 'Performance while tail or head wind'
wind_ratings %>% mutate(name=fct_reorder(name,performance,sum)) %>% ggplot(aes(name,performance, fill=wind_type)) + geom_bar(stat='identity')+ coord_flip() + labs(title=tmp_title)
View(size_ratings)
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1500)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, results, by = c('codex','round','id'))[,c('codex','performance','wind')] %>% na.omit()
selected_ratings['wind_type'] = cut(selected_ratings$wind, breaks = c(-10,0,10), labels=c('tail','head'))
wind_ratings = selected_ratings %>% group_by(wind_type,codex) %>% summarize(performance = mean(performance, na.rm = TRUE)) %>% na.omit()
wind_ratings = merge(wind_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex', by.y='codex')
tmp_title <- 'Performance while tail or head wind'
wind_ratings %>% mutate(name=fct_reorder(name,performance,sum)) %>% ggplot(aes(name,performance, fill=wind_type)) + geom_bar(stat='identity')+ coord_flip() + labs(title=tmp_title)
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['year'] = sapply(peak_ratings['date'],substring,1,4)
peak_ratings['year'] = sapply(peak_ratings['year'],as.numeric)
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=year)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip(ylim = c(1600, 2000))+scale_fill_gradient(low='red',high='green')
year=2010
selected_ids = unique(filter(competitions,season == year, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, competitions, by = c('id'))[,c('codex.x','season','cumm_rating')]
selected_ratings = filter(selected_ratings, season < year + 1)
selected_ratings = selected_ratings[!duplicated(selected_ratings$codex.x, fromLast = TRUE),]
selected_ratings  %>% ggplot(aes(cumm_rating, y=..density..)) + geom_density() + xlim(500,2000) + ylim(0,0.007)
year=2011
selected_ids = unique(filter(competitions,season == year, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, competitions, by = c('id'))[,c('codex.x','season','cumm_rating')]
selected_ratings = filter(selected_ratings, season < year + 1)
selected_ratings = selected_ratings[!duplicated(selected_ratings$codex.x, fromLast = TRUE),]
selected_ratings  %>% ggplot(aes(cumm_rating, y=..density..)) + geom_density() + xlim(500,2000) + ylim(0,0.007)
year=2012
selected_ids = unique(filter(competitions,season == year, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, competitions, by = c('id'))[,c('codex.x','season','cumm_rating')]
selected_ratings = filter(selected_ratings, season < year + 1)
selected_ratings = selected_ratings[!duplicated(selected_ratings$codex.x, fromLast = TRUE),]
selected_ratings  %>% ggplot(aes(cumm_rating, y=..density..)) + geom_density() + xlim(500,2000) + ylim(0,0.007)
year=2013
selected_ids = unique(filter(competitions,season == year, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, competitions, by = c('id'))[,c('codex.x','season','cumm_rating')]
selected_ratings = filter(selected_ratings, season < year + 1)
selected_ratings = selected_ratings[!duplicated(selected_ratings$codex.x, fromLast = TRUE),]
selected_ratings  %>% ggplot(aes(cumm_rating, y=..density..)) + geom_density() + xlim(500,2000) + ylim(0,0.007)
year=2014
selected_ids = unique(filter(competitions,season == year, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, competitions, by = c('id'))[,c('codex.x','season','cumm_rating')]
selected_ratings = filter(selected_ratings, season < year + 1)
selected_ratings = selected_ratings[!duplicated(selected_ratings$codex.x, fromLast = TRUE),]
selected_ratings  %>% ggplot(aes(cumm_rating, y=..density..)) + geom_density() + xlim(500,2000) + ylim(0,0.007)
year=2015
selected_ids = unique(filter(competitions,season == year, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, competitions, by = c('id'))[,c('codex.x','season','cumm_rating')]
selected_ratings = filter(selected_ratings, season < year + 1)
selected_ratings = selected_ratings[!duplicated(selected_ratings$codex.x, fromLast = TRUE),]
selected_ratings  %>% ggplot(aes(cumm_rating, y=..density..)) + geom_density() + xlim(500,2000) + ylim(0,0.007)
year=2016
selected_ids = unique(filter(competitions,season == year, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, competitions, by = c('id'))[,c('codex.x','season','cumm_rating')]
selected_ratings = filter(selected_ratings, season < year + 1)
selected_ratings = selected_ratings[!duplicated(selected_ratings$codex.x, fromLast = TRUE),]
selected_ratings  %>% ggplot(aes(cumm_rating, y=..density..)) + geom_density() + xlim(500,2000) + ylim(0,0.007)
year=2017
selected_ids = unique(filter(competitions,season == year, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, competitions, by = c('id'))[,c('codex.x','season','cumm_rating')]
selected_ratings = filter(selected_ratings, season < year + 1)
selected_ratings = selected_ratings[!duplicated(selected_ratings$codex.x, fromLast = TRUE),]
selected_ratings  %>% ggplot(aes(cumm_rating, y=..density..)) + geom_density() + xlim(500,2000) + ylim(0,0.007)
year=2018
selected_ids = unique(filter(competitions,season == year, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, competitions, by = c('id'))[,c('codex.x','season','cumm_rating')]
selected_ratings = filter(selected_ratings, season < year + 1)
selected_ratings = selected_ratings[!duplicated(selected_ratings$codex.x, fromLast = TRUE),]
selected_ratings  %>% ggplot(aes(cumm_rating, y=..density..)) + geom_density() + xlim(500,2000) + ylim(0,0.007)
year=2019
selected_ids = unique(filter(competitions,season == year, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, competitions, by = c('id'))[,c('codex.x','season','cumm_rating')]
selected_ratings = filter(selected_ratings, season < year + 1)
selected_ratings = selected_ratings[!duplicated(selected_ratings$codex.x, fromLast = TRUE),]
selected_ratings  %>% ggplot(aes(cumm_rating, y=..density..)) + geom_density() + xlim(500,2000) + ylim(0,0.007)
year=2020
selected_ids = unique(filter(competitions,season == year, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, competitions, by = c('id'))[,c('codex.x','season','cumm_rating')]
selected_ratings = filter(selected_ratings, season < year + 1)
selected_ratings = selected_ratings[!duplicated(selected_ratings$codex.x, fromLast = TRUE),]
selected_ratings  %>% ggplot(aes(cumm_rating, y=..density..)) + geom_density() + xlim(500,2000) + ylim(0,0.007)
year=2021
selected_ids = unique(filter(competitions,season == year, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, competitions, by = c('id'))[,c('codex.x','season','cumm_rating')]
selected_ratings = filter(selected_ratings, season < year + 1)
selected_ratings = selected_ratings[!duplicated(selected_ratings$codex.x, fromLast = TRUE),]
selected_ratings  %>% ggplot(aes(cumm_rating, y=..density..)) + geom_density() + xlim(500,2000) + ylim(0,0.007)
year=2014
selected_ids = unique(filter(competitions,season == year, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, competitions, by = c('id'))[,c('codex.x','season','cumm_rating')]
selected_ratings = filter(selected_ratings, season < year + 1)
selected_ratings = selected_ratings[!duplicated(selected_ratings$codex.x, fromLast = TRUE),]
selected_ratings  %>% ggplot(aes(cumm_rating, y=..density..)) + geom_density() + xlim(500,2000) + ylim(0,0.007)
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1500)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, results, by = c('codex','round','id'))[,c('codex','performance','delty','wind')] %>% na.omit()
selected_ratings['wind_type'] = cut(selected_ratings$wind, breaks = c(-10,0,10), labels=c('tail','head'))
wind_ratings = selected_ratings %>% group_by(wind_type,codex) %>% summarize(performance = mean(delty, na.rm = TRUE)) %>% na.omit()
wind_ratings = merge(wind_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex', by.y='codex')
tmp_title <- 'Performance while tail or head wind'
wind_ratings %>% mutate(name=fct_reorder(name,performance,sum)) %>% ggplot(aes(name,performance, fill=wind_type)) + geom_bar(stat='identity')+ coord_flip() + labs(title=tmp_title)
selected_ids = unique(filter(competitions,season == 2021, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = merge(selected_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'performance', 'meter.value', 'codex.x')]
selected_ratings['size'] = cut(
selected_ratings$meter.value,
breaks = c(0, 1.3, 1.9, 2.3, 2.5),
labels = c('flying hill', 'large', 'normal', 'medium')
)
size_ratings = selected_ratings %>% group_by(size,codex.x) %>% summarize(performance = mean(performance, na.rm = TRUE), n = n()) %>% na.omit()
size_ratings = merge(size_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
for (hill_type in levels(size_ratings$size)){
u=table(levels(size_ratings$size))
u[c('large','flying hill','normal','medium')]=c(90,30,60,10)
size_ratings_type = filter(size_ratings, size == hill_type & performance > 0 & n>=u[hill_type])
size_ratings_type = size_ratings_type %>% arrange(desc(performance)) %>% slice(1:15)
tmp_title <- paste('Performance on', hill_type)
print(size_ratings_type %>% mutate(name=fct_reorder(name,performance,sum)) %>% ggplot(aes(name,performance, fill = size)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip())
}
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1500)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, results, by = c('codex','round','id'))[,c('codex','performance','delty','wind')] %>% na.omit()
selected_ratings['wind_type'] = cut(selected_ratings$wind, breaks = c(-10,0,10), labels=c('tail','head'))
wind_ratings = selected_ratings %>% group_by(wind_type,codex) %>% summarize(performance = mean(delty, na.rm = TRUE)) %>% na.omit()
wind_ratings = merge(wind_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex', by.y='codex')
tmp_title <- 'Performance while tail or head wind'
wind_ratings %>% mutate(name=fct_reorder(name,performance,sum)) %>% ggplot(aes(name,performance, fill=wind_type)) + geom_bar(stat='identity')+ coord_flip() + labs(title=tmp_title)
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1500)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, results, by = c('codex','round','id'))[,c('codex','performance','delty','wind')] %>% na.omit()
selected_ratings['wind_type'] = cut(selected_ratings$wind, breaks = c(-10,0,10), labels=c('tail','head'))
wind_ratings = selected_ratings %>% group_by(wind_type,codex) %>% summarize(performance = mean(performance, na.rm = TRUE)) %>% na.omit()
wind_ratings = merge(wind_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex', by.y='codex')
tmp_title <- 'Performance while tail or head wind'
wind_ratings %>% mutate(name=fct_reorder(name,performance,sum)) %>% ggplot(aes(name,performance, fill=wind_type)) + geom_bar(stat='identity')+ coord_flip() + labs(title=tmp_title)
View(wind_ratings)
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1500)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = left_join(selected_ratings, results, by = c('codex','round','id'))[,c('codex','performance','delty','wind')] %>% na.omit()
selected_ratings['wind_type'] = cut(selected_ratings$wind, breaks = c(-10,0,10), labels=c('tail','head'))
wind_ratings = selected_ratings %>% group_by(wind_type,codex) %>% summarize(performance = mean(performance, na.rm = TRUE), n = n()) %>% na.omit()
wind_ratings = merge(wind_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex', by.y='codex')
tmp_title <- 'Performance while tail or head wind'
wind_ratings %>% mutate(name=fct_reorder(name,performance,sum)) %>% ggplot(aes(name,performance, fill=wind_type)) + geom_bar(stat='identity')+ coord_flip() + labs(title=tmp_title)
View(wind_ratings)

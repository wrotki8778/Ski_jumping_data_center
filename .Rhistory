knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(e1071)
competitions = read.csv('all_comps_r.csv',sep=',',dec='.',stringsAsFactors = TRUE)
results = read.csv('all_results.csv',sep=',',dec='.')
names = read.csv('all_names.csv',sep=',',dec='.',stringsAsFactors = TRUE)
stats  = read.csv('all_stats_r.csv',sep=',',dec='.',stringsAsFactors = TRUE)
summary(competitions)
counts <- as.data.frame(table(competitions$place,competitions$gender))
counts_raw <- counts[aggregate(Freq ~ Var1,counts, sum)$Freq>50,]
counts <- filter(counts,counts$Var1 %in% counts_raw$Var1)
counts %>%
mutate(Var1 = fct_reorder(Var1,Freq,sum)) %>%
ggplot(aes(x=Var1, y=Freq, fill=Var2)) +
geom_bar(stat="identity", alpha=.6, width=.4) +
coord_flip() +
scale_fill_discrete(name = "Gender") +
xlab("") +
theme_bw()
countries <- as.data.frame(table(competitions$country,competitions$gender))
countries_raw <- countries[aggregate(Freq ~ Var1,countries, sum)$Freq>50,]
countries <- filter(countries,countries$Var1 %in% countries_raw$Var1)
countries %>%
mutate(Var1 = fct_reorder(Var1,Freq,sum)) %>%
ggplot(aes(x=Var1, y=Freq, fill=Var2)) +
geom_bar(stat="identity", alpha=.6, width=.4) +
coord_flip() +
scale_fill_discrete(name = "Gender") +
xlab("") +
theme_bw()
competitions['type_str'] = cut(competitions$type, breaks = c(-0.5,0.5,1.5,2.5,3.5,5.5), labels=c('WC', 'COC', 'GP','FC','Other'))
types <- as.data.frame(table(competitions$place,competitions$type_str))
types_raw <- types[aggregate(Freq ~ Var1,types, sum)$Freq>100,]
types <- filter(types,types$Var1 %in% types_raw$Var1)
types %>%
mutate(Var1 = fct_reorder(Var1,Freq,sum)) %>%
ggplot(aes(x=Var1, y=Freq, fill=Var2)) +
geom_bar(stat="identity", alpha=.6, width=.4) +
scale_fill_discrete(name = "Type") +
coord_flip() +
xlab("") +
theme_bw()
competitions['size'] = cut(competitions$hill_size_x, breaks = c(0,85,120,160,300), labels=c('small', 'normal', 'large','flying hill'))
ggplot(subset(competitions, gender %in% c("Men", "Women"))) +
geom_bar(aes(x = size, color=gender),fill="white", alpha = 0.6, position="dodge")
ggplot(competitions) +
geom_bar(aes(x = size, color=type_str),fill="white", alpha = 0.6, position="dodge")
summary(stats)
stats['summer'] = apply(stats[,c('snow','air')], 1, function(y){
if (is.na(y['snow'])==1 & is.na(y['air']) == 0) return('summer')
else if (is.na(y['snow']) == 0 & is.na(y['air']) == 0) return('winter')
return(NA)
})
ggplot(stats) +
geom_density(aes(x = air, color = summer),fill="white", alpha = 0.6)+labs(title='Temperature plot')
ggplot(stats) +
geom_density(aes(x = humid, color = summer),fill="white", alpha = 0.6)+labs(title='Humidity plot')+xlim(0,100)
ggplot(stats) +
geom_density(aes(x = snow),fill="white", alpha = 0.6)+labs(title='Snow temperature plot in winter')+xlim(-25,5)
unique_stats = stats[!duplicated(stats$fis_code),]
tmp_data = merge(unique_stats,competitions,by.x = 'fis_code', by.y = 'id')
tmp_data['jumpers']= cut(tmp_data$all_jumpers, breaks = c(0,30,40,50,60,70,110))
ggplot(tmp_data) +
geom_density(aes(x = all_jumpers, color=gender),fill="white", alpha = 0.6, position="dodge")
ggplot(tmp_data) +
geom_density(aes(x = all_jumpers, color=type_str),fill="white", alpha = 0.6, position="dodge")
View(tmp_data)
unique_stats = stats[!duplicated(stats$fis_code),]
tmp_data = merge(unique_stats,competitions,by.x = 'fis_code', by.y = 'id')
tmp_data['jumpers']= cut(tmp_data$all_jumpers, breaks = c(0,30,40,50,60,70,110))
ggplot(tmp_data) +
geom_bar(aes(x = jumpers, color=gender),fill="white", alpha = 0.6, position="dodge")
ggplot(tmp_data) +
geom_bar(aes(x = jumpers, color=type_str),fill="white", alpha = 0.6, position="dodge")
unique_stats = stats[!duplicated(stats$fis_code),]
tmp_data = merge(unique_stats,competitions,by.x = 'fis_code', by.y = 'id')
tmp_data['jumpers']= cut(tmp_data$all_jumpers, breaks = c(0,35,45,55,65,75,110))
ggplot(tmp_data) +
geom_bar(aes(x = jumpers, color=gender),fill="white", alpha = 0.6, position="dodge")
ggplot(tmp_data) +
geom_bar(aes(x = jumpers, color=type_str),fill="white", alpha = 0.6, position="dodge")
View(competitions)
?sapply(list, function)
?sapply
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(e1071)
ratings = read.csv('all_ratings.csv',sep=',',dec='.',stringsAsFactors = TRUE)
names = read.csv('all_names.csv',sep=',',dec='.',stringsAsFactors = TRUE)
competitions = read.csv('all_comps_r.csv',sep=',',dec='.',stringsAsFactors = TRUE)
summary(ratings)
graph_names = c('kraft stefan','kobayashi ryoyu', 'kasai noriaki', 'granerud halvor egner')
for (name in graph_names){
jumper_id = names[names['name'] == name,2][1]
filtered_ratings = filter(ratings, codex == jumper_id)[, c('cumm_rating', 'id', 'number')]
tmp_title <- paste('Performance graph of: ', name)
graph <- ggplot(filtered_ratings, aes(number, cumm_rating)) + geom_smooth() + geom_line() + labs(title=tmp_title) + xlim(0,2150) + ylim(600,2000)
print(graph)
}
graph_names = c('kraft stefan',
'kubacki dawid',
'kasai noriaki',
'lundby maren')
for (name in graph_names) {
jumper_id = names[names['name'] == name, 2][1]
filtered_ratings = filter(ratings, codex == jumper_id)[, c('delty', 'id', 'number')]
filtered_ratings = merge(filtered_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('delty', 'id', 'meter.value', 'number')]
filtered_ratings['size'] = cut(
filtered_ratings$meter.value,
breaks = c(0, 1.3, 1.9, 2.3, 2.5),
labels = c('flying hill', 'large', 'normal', 'medium')
)
filtered_ratings$csum <-
ave(filtered_ratings$delty, filtered_ratings$size, FUN = cumsum)
filtered_ratings = merge(
filtered_ratings,
as.data.frame(table(filtered_ratings$size)),
how = 'left',
by.x = 'size',
by.y = 'Var1'
)
tmp_title <- paste('Performance boxplot by hill of: ', name)
print(ggplot(filtered_ratings, aes(size, delty, fill = size)) + geom_boxplot() + ylim(-20, 20) + labs(title=tmp_title))
tmp_title_2 <- paste('Performance graph by hill type of: ', name)
print(ggplot(filtered_ratings, aes(number, csum, color = size)) + geom_smooth() + geom_line() + labs(title=tmp_title_2)+ xlim(0,2150) + ylim(-500,1000))
}
selected_ids = unique(filter(competitions,season == 2021, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids & cumm_rating > 1500)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = merge(selected_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'delty', 'meter.value', 'codex.x')]
selected_ratings['size'] = cut(
selected_ratings$meter.value,
breaks = c(0, 1.3, 1.9, 2.3, 2.5),
labels = c('flying hill', 'large', 'normal', 'medium')
)
size_ratings = selected_ratings %>% group_by(size,codex.x) %>% summarize(delty = sum(delty, na.rm = TRUE)) %>% na.omit()
size_ratings = merge(size_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
tmp_title <- 'Performance on all types of hills'
size_ratings %>% mutate(name=fct_reorder(name,delty,sum)) %>% ggplot(aes(name,delty, fill = size)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()
selected_ids = unique(filter(competitions,season == 2021, gender == 'Men')[['id']])
selected_codex = unique(filter(ratings, id %in% selected_ids)[['codex']])
selected_ratings = filter(ratings, codex %in% selected_codex)
selected_ratings = merge(selected_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'delty', 'meter.value', 'codex.x')]
selected_ratings['size'] = cut(
selected_ratings$meter.value,
breaks = c(0, 1.3, 1.9, 2.3, 2.5),
labels = c('flying hill', 'large', 'normal', 'medium')
)
size_ratings = selected_ratings %>% group_by(size,codex.x) %>% summarize(delty = sum(delty, na.rm = TRUE)) %>% na.omit()
size_ratings = merge(size_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
for (hill_type in levels(size_ratings$size)){
size_ratings_type = filter(size_ratings, size == hill_type & delty > 0)
size_ratings_type = size_ratings_type %>% arrange(desc(delty)) %>% slice(1:15)
tmp_title <- paste('Performance on', hill_type)
print(size_ratings_type %>% mutate(name=fct_reorder(name,delty,sum)) %>% ggplot(aes(name,delty, fill = size)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip())
}
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date)
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=as.Date(date))) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
View(peak_ratings)
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date)
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date, format='%d-%m-%Y')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
View(peak_ratings)
?as.Date
View(ratings)
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
View(peak_ratings)
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date, format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
View(peak_ratings)
?date
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],format, format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
View(peak_ratings)
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date, format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date, format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=as.character(date))) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
View(peak_ratings)
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date, format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date)
peak_ratings['date'] = sapply(peak_ratings['date'],format,'%Y-%m-$d')
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date)
peak_ratings['date'] = sapply(peak_ratings['date'],format,'%Y-%m-%d')
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date)
peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
View(peak_ratings)
as.Date('2018-02-25')
format(as.Date('2018-02-25'),'%Y-%m-%d')
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date)
#peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date.factor)
#peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date.factor)
peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date.factor)
#peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
View(peak_ratings)
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date)
#peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.character)
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date)
#peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
View(peak_ratings)
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
#peak_ratings['date'] = sapply(peak_ratings['date'],as.character)
peak_ratings['date'] = sapply(peak_ratings['date'],strptime)
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
#peak_ratings['date'] = sapply(peak_ratings['date'],as.character)
peak_ratings['date'] = sapply(peak_ratings['date'],strptime,format='%Y-%m-%d')
#peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
View(peak_ratings)
View(peak_ratings[[4]][[1]])
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
#peak_ratings['date'] = sapply(peak_ratings['date'],as.character)
peak_ratings['date'] = strptime(peak_ratings['date'],format='%Y-%m-%d')
#peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
View(peak_ratings)
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
#peak_ratings['date'] = sapply(peak_ratings['date'],as.character)
peak_ratings['date'] = sapply(peak_ratings['date'],strptime,format='%Y-%m-%d')
#peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date)
#peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.character)
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date)
#peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
View(peak_ratings)
View(peak_ratings)
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.character)
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date.character)
#peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
View(peak_ratings)
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.character)
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date.date)
?as.Date.date
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.character)
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date, origin = "1900-01-01")
#peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
View(peak_ratings)
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.character)
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date.character, origin = "1900-01-01")
#peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.character)
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date.date, origin = "1900-01-01")
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.character)
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date, origin = "1900-01-01")
#peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = sapply(peak_ratings['date'],as.Date, origin = "1900-01-01")
#peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
View(peak_ratings)
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
View(peak_ratings)
as.Date(peak_ratings$date[1])
as.Date(peak_ratings$date[3])
as.Date(peak_ratings$date[3], origin = "1900-01-01")
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = lapply(peak_ratings['date'],as.Date, origin = "1900-01-01")
#peak_ratings['date'] = sapply(peak_ratings['date'],format,format='%Y-%m-%d')
tmp_title <- paste('Peak ratings')
peak_ratings %>% mutate(name=fct_reorder(name,cumm_rating,sum)) %>% ggplot(aes(name,cumm_rating, fill=date)) + geom_bar(stat='identity') + labs(title=tmp_title)+coord_flip()+scale_fill_gradientn(colours = terrain.colors(3))
peak_ratings = ratings %>% arrange(desc(cumm_rating)) %>% distinct(codex, .keep_all = TRUE)  %>% slice(1:30)
peak_ratings = merge(peak_ratings,
competitions,
by.x = 'id',
by.y = 'id')[, c('id', 'cumm_rating', 'date', 'codex.x')]
peak_ratings = merge(peak_ratings,names[!duplicated(names[,c('codex')]),], how='left', by.x='codex.x', by.y='codex')
peak_ratings['date'] = apply(peak_ratings['date'],as.Date, origin = "1900-01-01")

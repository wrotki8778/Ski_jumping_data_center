---
title: "Initial SJ markdown"
author: "WF"
date: "30 01 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

The analysis below corresponds with the data uploaded yesterday (27.01.21) on kaggle.com. In this case we will not go beyond the basic EDA. I will mainly concentrate on the file containing information about competitions. 

## How these data look like?

Let's begin with the data and libraries import:

```{r import}
library(tidyverse)

competitions = read.csv2('all_comps.csv',sep=',',dec='.',stringsAsFactors = TRUE)
results = read.csv2('all_results.csv',sep=',',dec='.')
names = read.csv2('all_names.csv',sep=',',dec='.',stringsAsFactors = TRUE)

summary(competitions)
summary(results)
```
In fact in 'competitions' dataset we have mostly integer variables. What is interesting only from this code is that

* the NA values are apparent - mostly in these cases, when 
  + the wind/gate factor was not taken into account (roughly 25% of competitions and 20% of jumps, mainly in COC/FC competitions)
  + the style was not counted (all training rounds, roughly 45% of total number of jumps)
  + parsing of PDF file was not successful (roughly 6% of competitions, mainly before 2012/13 and for COC/FC types)
* most competitions was held in Germany and in Norway.

Let's see the most "fashioned" places and countries, grouped also by the type of competition
```{r barplots, echo=FALSE}
require(ggplot2)
require(tidyverse)

counts <- as.data.frame(table(competitions$place,competitions$gender))
counts_raw <- counts[aggregate(Freq ~ Var1,counts, sum)$Freq>50,]
counts <- filter(counts,counts$Var1 %in% counts_raw$Var1)
counts %>%
  mutate(Var1 = fct_reorder(Var1,Freq,sum)) %>%
  ggplot(aes(x=Var1, y=Freq, fill=Var2)) +
    geom_bar(stat="identity", alpha=.6, width=.4) +
    coord_flip() +
    scale_fill_discrete(name = "Gender") +
    xlab("") +
    theme_bw()

countries <- as.data.frame(table(competitions$country,competitions$gender))
countries_raw <- countries[aggregate(Freq ~ Var1,countries, sum)$Freq>50,]
countries <- filter(countries,countries$Var1 %in% countries_raw$Var1)
countries %>%
  mutate(Var1 = fct_reorder(Var1,Freq,sum)) %>%
  ggplot(aes(x=Var1, y=Freq, fill=Var2)) +
    geom_bar(stat="identity", alpha=.6, width=.4) +
    coord_flip() +
    scale_fill_discrete(name = "Gender") +
    xlab("") +
    theme_bw()

competitions['type_str'] = cut(competitions$type, breaks = c(-0.5,0.5,1.5,2.5,3.5,5.5), labels=c('WC', 'COC', 'GP','FC','Other')) 

types <- as.data.frame(table(competitions$place,competitions$type_str))
types_raw <- types[aggregate(Freq ~ Var1,types, sum)$Freq>100,]
types <- filter(types,types$Var1 %in% types_raw$Var1)
types %>%
  mutate(Var1 = fct_reorder(Var1,Freq,sum)) %>%
  ggplot(aes(x=Var1, y=Freq, fill=Var2)) +
    geom_bar(stat="identity", alpha=.6, width=.4) +
    scale_fill_discrete(name = "Type") +
    coord_flip() +
    xlab("") +
    theme_bw()
```

As we can see, various hills and cities have different "target" and its own specificity in terms of organizing ski jumping competitions. Let's see the sizes of different objects appearing in the dataset and the counts:

```{r}
competitions['size'] = cut(competitions$hill_size_x, breaks = c(0,85,120,160,300), labels=c('small', 'normal', 'large','flying hill')) 
ggplot(subset(competitions, gender %in% c("Men", "Women"))) +
  geom_bar(aes(x = size, color=gender),fill="white", alpha = 0.6, position="dodge")
```

From this plot we can see that

* women compete mostly on the normal hills and men jump mainly on the large objects,
* women participate in substantially less number of competitions than men.


